<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¤ªç©ºå¤ºå® - ç›†åº•è‚Œä¿®å¤æ¸¸æˆ Demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a2e;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            color: white;
            font-family: sans-serif;
        }
        #gameCanvas {
            border: 2px solid #333;
            background: linear-gradient(to right, #0f0c29, #302b63, #24243e);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            cursor: crosshair; /* éšè—é¼ æ ‡æŒ‡é’ˆï¼Œç”¨é£èˆ¹ä»£æ›¿ */
        }
        .ui-container {
            position: absolute;
            pointer-events: none;
            width: 800px;
            height: 450px;
        }
        .top-left-ui {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 15px;
            font-size: 18px;
            font-weight: bold;
        }
        .icon-text {
            display: flex;
            align-items: center;
        }
        .icon-text span {
            margin-right: 5px;
            font-size: 20px;
        }
        .hit-counter {
            position: absolute;
            left: 180px;
            top: 200px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px #00d2ff;
            transition: transform 0.1s;
        }
        .progress-bar-container {
            position: absolute;
            right: 20px;
            top: 100px;
            height: 250px;
            width: 15px;
            background-color: #333;
            border-radius: 10px;
            border: 2px solid #555;
        }
        #progressBar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, #ff9a44, #fc6076);
            border-radius: 10px;
            transition: height 0.2s;
        }
        .progress-label {
            position: absolute;
            right: 15px;
            bottom: 80px;
            font-size: 14px;
        }
        .target-icon {
            position: absolute;
            right: 13px;
            top: 75px;
            font-size: 24px;
        }
    </style>
</head>
<body>

<div class="ui-container">
    <div class="top-left-ui">
        <div class="icon-text"><span>ğŸ‘‘</span><div id="scoreUi">0</div></div>
        <div class="icon-text"><span>â¤ï¸</span><div id="healthUi">50</div></div>
    </div>
    <div class="target-icon">ğŸ¯</div>
    <div class="progress-bar-container">
        <div id="progressBar"></div>
    </div>
    <div class="progress-label">100%</div>
    <div class="hit-counter" id="hitCounterUi"></div>
</div>

<canvas id="gameCanvas" width="800" height="450"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const scoreUi = document.getElementById('scoreUi');
    const healthUi = document.getElementById('healthUi');
    const hitCounterUi = document.getElementById('hitCounterUi');
    const progressBar = document.getElementById('progressBar');

    // æ¸¸æˆçŠ¶æ€
    let score = 0;
    let health = 50;
    let hits = 0;
    let gameProgress = 0;
    let lastHitTime = 0;
    let hitComboDisplayTimer = null;

    // ç©å®¶é£èˆ¹
    const player = {
        x: 50,
        y: canvas.height / 2,
        width: 40,
        height: 20,
        color: '#00d2ff',
        targetY: canvas.height / 2 // é¼ æ ‡ç›®æ ‡ä½ç½®
    };

    // å­å¼¹æ•°ç»„
    let bullets = [];
    // ç›®æ ‡ï¼ˆå®çŸ³ï¼‰æ•°ç»„
    let targets = [];
    // ç²’å­æ•ˆæœæ•°ç»„
    let particles = [];
    // æ‰è½çº¢å¿ƒæ•°ç»„
    let hearts = [];

    // é¼ æ ‡æ§åˆ¶
    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        player.targetY = e.clientY - rect.top;
    });

    // å·¥å…·å‡½æ•°ï¼šç”Ÿæˆéšæœºé¢œè‰²
    function getRandomColor() {
        const colors = ['#ff4757', '#2ed573', '#1e90ff', '#ffa502', '#a55eea'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    // ç±»å®šä¹‰
    class Bullet {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.speed = 10;
            this.width = 15;
            this.height = 4;
            this.color = '#ffdd59';
        }
        update() {
            this.x += this.speed;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            // å­å¼¹å°¾è¿¹å…‰æ™•
            ctx.shadowBlur = 10;
            ctx.shadowColor = this.color;
            ctx.fillRect(this.x - 5, this.y + 1, this.width, this.height-2);
            ctx.shadowBlur = 0;
        }
    }

    class Target {
        constructor() {
            this.size = Math.random() * 20 + 15;
            this.x = canvas.width + this.size;
            this.y = Math.random() * (canvas.height - this.size * 2) + this.size;
            this.speed = Math.random() * 2 + 1.5;
            this.color = getRandomColor();
            this.type = Math.random() > 0.5 ? 'circle' : 'square';
            this.rotation = 0;
            this.rotationSpeed = Math.random() * 0.05 * (Math.random() > 0.5 ? 1 : -1);
        }
        update() {
            this.x -= this.speed;
            this.rotation += this.rotationSpeed;
        }
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.rotation);
            ctx.fillStyle = this.color;
            if (this.type === 'circle') {
                ctx.beginPath();
                ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2);
                ctx.fill();
            } else {
                ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size);
            }
            ctx.restore();
        }
    }

    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.size = Math.random() * 5 + 2;
            this.speedX = (Math.random() - 0.5) * 8;
            this.speedY = (Math.random() - 0.5) * 8;
            this.color = color;
            this.alpha = 1;
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            this.alpha -= 0.03;
        }
        draw() {
            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
    }

    class HeartDrop {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.size = 20;
            this.speed = 1.5;
        }
        update() {
            this.x -= this.speed;
            // ç®€å•çš„ä¸Šä¸‹æµ®åŠ¨æ•ˆæœ
            this.y += Math.sin(Date.now() / 200) * 0.5;
        }
        draw() {
            ctx.font = "20px Arial";
            ctx.fillText("â¤ï¸", this.x - 10, this.y + 8);
        }
    }

    // æ¸¸æˆä¸»å¾ªç¯
    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. æ›´æ–°ç©å®¶ä½ç½® (å¹³æ»‘è·Ÿéšé¼ æ ‡)
        player.y += (player.targetY - player.y) * 0.2;

        // 2. ç»˜åˆ¶ç©å®¶é£èˆ¹ (ç®€å•çš„å½¢çŠ¶æ¨¡æ‹Ÿ)
        ctx.fillStyle = player.color;
        ctx.beginPath();
        ctx.moveTo(player.x + player.width, player.y);
        ctx.lineTo(player.x, player.y - player.height / 2);
        ctx.lineTo(player.x, player.y + player.height / 2);
        ctx.closePath();
        ctx.fill();
        // é£èˆ¹å¼•æ“å…‰æ•ˆ
        ctx.fillStyle = '#ff9a44';
        ctx.beginPath();
        ctx.moveTo(player.x, player.y);
        ctx.lineTo(player.x - 10, player.y - 5);
        ctx.lineTo(player.x - 15, player.y);
        ctx.lineTo(player.x - 10, player.y + 5);
        ctx.fill();

        // 3. å‘å°„å­å¼¹ (æ¯éš”å‡ å¸§å‘å°„ä¸€é¢—)
        if (frame % 8 === 0) {
            bullets.push(new Bullet(player.x + player.width, player.y));
        }

        // 4. ç”Ÿæˆç›®æ ‡
        if (frame % 30 === 0) {
            targets.push(new Target());
        }

        // 5. æ›´æ–°å’Œç»˜åˆ¶æ‰€æœ‰å¯¹è±¡
        handleBullets();
        handleTargets();
        handleParticles();
        handleHearts();
        updateUI();

        frame++;
        requestAnimationFrame(animate);
    }

    let frame = 0;

    function handleBullets() {
        for (let i = bullets.length - 1; i >= 0; i--) {
            bullets[i].update();
            bullets[i].draw();
            // ç§»é™¤å±å¹•å¤–çš„å­å¼¹
            if (bullets[i].x > canvas.width) {
                bullets.splice(i, 1);
            }
        }
    }

    function handleTargets() {
        for (let i = targets.length - 1; i >= 0; i--) {
            targets[i].update();
            targets[i].draw();

            // ç¢°æ’æ£€æµ‹ (å­å¼¹å‡»ä¸­ç›®æ ‡)
            for (let j = bullets.length - 1; j >= 0; j--) {
                if (bullets[j] && targets[i] && checkCollision(bullets[j], targets[i])) {
                    createExplosion(targets[i].x, targets[i].y, targets[i].color);
                    
                    // 10%å‡ ç‡æ‰è½çº¢å¿ƒ
                    if (Math.random() < 0.1) {
                        hearts.push(new HeartDrop(targets[i].x, targets[i].y));
                    }

                    bullets.splice(j, 1);
                    targets.splice(i, 1);
                    
                    // æ›´æ–°çŠ¶æ€
                    hits++;
                    score += 10;
                    gameProgress += 0.5;
                    if(gameProgress > 100) gameProgress = 100;
                    showHitText();
                    // è·³å‡ºå†…å±‚å¾ªç¯ï¼Œå› ä¸ºè¯¥ç›®æ ‡å·²æ¶ˆå¤±
                    break; 
                }
            }
            // ç§»é™¤å±å¹•å¤–çš„ç›®æ ‡
            if (targets[i] && targets[i].x + targets[i].size < 0) {
                targets.splice(i, 1);
            }
        }
    }

    function handleHearts() {
         for (let i = hearts.length - 1; i >= 0; i--) {
            hearts[i].update();
            hearts[i].draw();

            // ç©å®¶æ”¶é›†çº¢å¿ƒæ£€æµ‹
            // ç®€åŒ–çš„ç¢°æ’ï¼šæ£€æŸ¥é£èˆ¹ä¸­å¿ƒä¸çº¢å¿ƒçš„è·ç¦»
            const dx = player.x - hearts[i].x;
            const dy = player.y - hearts[i].y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < player.height + hearts[i].size / 2) {
                health++;
                hearts.splice(i, 1);
            } else if (hearts[i].x < 0) {
                 hearts.splice(i, 1);
            }
        }
    }

    function handleParticles() {
        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].update();
            particles[i].draw();
            if (particles[i].alpha <= 0) {
                particles.splice(i, 1);
            }
        }
    }

    function createExplosion(x, y, color) {
        for (let i = 0; i < 8; i++) {
            particles.push(new Particle(x, y, color));
        }
    }

    // ç®€å•çš„çŸ©å½¢ä¸åœ†å½¢/çŸ©å½¢ä¸­å¿ƒç¢°æ’æ£€æµ‹è¿‘ä¼¼
    function checkCollision(bullet, target) {
        const distX = Math.abs(bullet.x - target.x);
        const distY = Math.abs(bullet.y - target.y);

        // ç®€åŒ–åˆ¤æ–­ï¼šå¦‚æœå­å¼¹ä¸­å¿ƒè¿›å…¥äº†ç›®æ ‡çš„è¾¹ç•Œæ¡†å†…
        if (distX < (bullet.width/2 + target.size/2) && distY < (bullet.height/2 + target.size/2)) {
            return true;
        }
        return false;
    }

    function updateUI() {
        scoreUi.innerText = score;
        healthUi.innerText = health;
        progressBar.style.height = gameProgress + '%';
    }

    function showHitText() {
        hitCounterUi.innerText = hits + " HIT!";
        hitCounterUi.style.transform = "scale(1.2)";
        clearTimeout(hitComboDisplayTimer);
        hitComboDisplayTimer = setTimeout(() => {
             hitCounterUi.style.transform = "scale(1.0)";
             // è§†é¢‘ä¸­HITæ•°ä¼šä¸€ç›´æ˜¾ç¤ºï¼Œç›´åˆ°missï¼Œè¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬è®©å®ƒæ·¡å‡ºæˆ–è€…ä¿æŒ
             // å¦‚æœè¦å®Œå…¨æ¨¡ä»¿è§†é¢‘ï¼Œéœ€è¦å¢åŠ  miss æœºåˆ¶æ¥é‡ç½® hits
        }, 100);
    }

    // å¼€å§‹æ¸¸æˆ
    animate();

</script>
</body>
</html>
